<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Package Tutorial - Using SVA Correction â€¢ hetAge</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.7.1/clipboard.min.js" integrity="sha384-cV+rhyOuRHc9Ub/91rihWcGmMmCXDeksTtCihMupQHSsi8GIIRDG0ThDc3HGQFJ3" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Package Tutorial - Using SVA Correction">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">hetAge</a>
        <span class="label label-default" data-toggle="tooltip" data-placement="bottom" title="Released package">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/tutorial-LR.html">Package Tutorial - Using LR Correction</a>
    </li>
    <li>
      <a href="../articles/tutorial-sva.html">Package Tutorial - Using SVA Correction</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Package Tutorial - Using SVA Correction</h1>
                        <h4 class="author">Melike Donertas</h4>
            
            <h4 class="date">2019-03-28</h4>
      
      
      <div class="hidden name"><code>tutorial-sva.Rmd</code></div>

    </div>

    
    
<div id="download-data-and-prepare-for-the-analysis" class="section level1">
<h1 class="hasAnchor">
<a href="#download-data-and-prepare-for-the-analysis" class="anchor"></a>Download data and prepare for the analysis</h1>
<p>Data is downloaded from GEO using getGEO function in GEOquery library. Expression matrix with probeset IDs, age of the samples and covarietes to be included in the analysis are extracted from geo object. Please note that this tutorial is just to demonstrate the functionality of this package and is not a proper gene expression analysis tutorial. Thus we skip many potential QC steps and probeset -&gt; gene ID mapping.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="kw">library</span>(GEOquery)</a>
<a class="sourceLine" id="cb1-2" data-line-number="2"><span class="co">#&gt; Loading required package: Biobase</span></a>
<a class="sourceLine" id="cb1-3" data-line-number="3"><span class="co">#&gt; Loading required package: BiocGenerics</span></a>
<a class="sourceLine" id="cb1-4" data-line-number="4"><span class="co">#&gt; Loading required package: parallel</span></a>
<a class="sourceLine" id="cb1-5" data-line-number="5"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb1-6" data-line-number="6"><span class="co">#&gt; Attaching package: 'BiocGenerics'</span></a>
<a class="sourceLine" id="cb1-7" data-line-number="7"><span class="co">#&gt; The following objects are masked from 'package:parallel':</span></a>
<a class="sourceLine" id="cb1-8" data-line-number="8"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb1-9" data-line-number="9"><span class="co">#&gt;     clusterApply, clusterApplyLB, clusterCall, clusterEvalQ,</span></a>
<a class="sourceLine" id="cb1-10" data-line-number="10"><span class="co">#&gt;     clusterExport, clusterMap, parApply, parCapply, parLapply,</span></a>
<a class="sourceLine" id="cb1-11" data-line-number="11"><span class="co">#&gt;     parLapplyLB, parRapply, parSapply, parSapplyLB</span></a>
<a class="sourceLine" id="cb1-12" data-line-number="12"><span class="co">#&gt; The following objects are masked from 'package:stats':</span></a>
<a class="sourceLine" id="cb1-13" data-line-number="13"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb1-14" data-line-number="14"><span class="co">#&gt;     IQR, mad, sd, var, xtabs</span></a>
<a class="sourceLine" id="cb1-15" data-line-number="15"><span class="co">#&gt; The following objects are masked from 'package:base':</span></a>
<a class="sourceLine" id="cb1-16" data-line-number="16"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb1-17" data-line-number="17"><span class="co">#&gt;     anyDuplicated, append, as.data.frame, basename, cbind,</span></a>
<a class="sourceLine" id="cb1-18" data-line-number="18"><span class="co">#&gt;     colMeans, colnames, colSums, dirname, do.call, duplicated,</span></a>
<a class="sourceLine" id="cb1-19" data-line-number="19"><span class="co">#&gt;     eval, evalq, Filter, Find, get, grep, grepl, intersect,</span></a>
<a class="sourceLine" id="cb1-20" data-line-number="20"><span class="co">#&gt;     is.unsorted, lapply, lengths, Map, mapply, match, mget, order,</span></a>
<a class="sourceLine" id="cb1-21" data-line-number="21"><span class="co">#&gt;     paste, pmax, pmax.int, pmin, pmin.int, Position, rank, rbind,</span></a>
<a class="sourceLine" id="cb1-22" data-line-number="22"><span class="co">#&gt;     Reduce, rowMeans, rownames, rowSums, sapply, setdiff, sort,</span></a>
<a class="sourceLine" id="cb1-23" data-line-number="23"><span class="co">#&gt;     table, tapply, union, unique, unsplit, which, which.max,</span></a>
<a class="sourceLine" id="cb1-24" data-line-number="24"><span class="co">#&gt;     which.min</span></a>
<a class="sourceLine" id="cb1-25" data-line-number="25"><span class="co">#&gt; Welcome to Bioconductor</span></a>
<a class="sourceLine" id="cb1-26" data-line-number="26"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb1-27" data-line-number="27"><span class="co">#&gt;     Vignettes contain introductory material; view with</span></a>
<a class="sourceLine" id="cb1-28" data-line-number="28"><span class="co">#&gt;     'browseVignettes()'. To cite Bioconductor, see</span></a>
<a class="sourceLine" id="cb1-29" data-line-number="29"><span class="co">#&gt;     'citation("Biobase")', and for packages 'citation("pkgname")'.</span></a>
<a class="sourceLine" id="cb1-30" data-line-number="30"><span class="co">#&gt; Setting options('download.file.method.GEOquery'='auto')</span></a>
<a class="sourceLine" id="cb1-31" data-line-number="31"><span class="co">#&gt; Setting options('GEOquery.inmemory.gpl'=FALSE)</span></a>
<a class="sourceLine" id="cb1-32" data-line-number="32">geo &lt;-<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/GEOquery/topics/getGEO">getGEO</a></span>(<span class="st">'GSE30272'</span>,<span class="dt">destdir =</span> <span class="st">'~/temp/'</span>)[[<span class="dv">1</span>]]</a>
<a class="sourceLine" id="cb1-33" data-line-number="33"><span class="co">#&gt; Found 1 file(s)</span></a>
<a class="sourceLine" id="cb1-34" data-line-number="34"><span class="co">#&gt; GSE30272_series_matrix.txt.gz</span></a>
<a class="sourceLine" id="cb1-35" data-line-number="35"><span class="co">#&gt; Using locally cached version: ~/temp//GSE30272_series_matrix.txt.gz</span></a>
<a class="sourceLine" id="cb1-36" data-line-number="36"><span class="co">#&gt; Parsed with column specification:</span></a>
<a class="sourceLine" id="cb1-37" data-line-number="37"><span class="co">#&gt; cols(</span></a>
<a class="sourceLine" id="cb1-38" data-line-number="38"><span class="co">#&gt;   .default = col_double(),</span></a>
<a class="sourceLine" id="cb1-39" data-line-number="39"><span class="co">#&gt;   ID_REF = col_character()</span></a>
<a class="sourceLine" id="cb1-40" data-line-number="40"><span class="co">#&gt; )</span></a>
<a class="sourceLine" id="cb1-41" data-line-number="41"><span class="co">#&gt; See spec(...) for full column specifications.</span></a>
<a class="sourceLine" id="cb1-42" data-line-number="42"><span class="co">#&gt; Using locally cached version of GPL4611 found here:</span></a>
<a class="sourceLine" id="cb1-43" data-line-number="43"><span class="co">#&gt; ~/temp//GPL4611.soft</span></a>
<a class="sourceLine" id="cb1-44" data-line-number="44">pd &lt;-<span class="st"> </span><span class="kw">pData</span>(geo)</a>
<a class="sourceLine" id="cb1-45" data-line-number="45">expmat &lt;-<span class="st"> </span><span class="kw">exprs</span>(geo)</a>
<a class="sourceLine" id="cb1-46" data-line-number="46">ages &lt;-<span class="st"> </span><span class="kw">setNames</span>(<span class="kw">as.numeric</span>(pd<span class="op">$</span><span class="st">`</span><span class="dt">age:ch1</span><span class="st">`</span>), pd<span class="op">$</span>geo_accession)</a>
<a class="sourceLine" id="cb1-47" data-line-number="47">covs &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">array =</span> <span class="kw">as.factor</span>(<span class="kw">setNames</span>(pd<span class="op">$</span><span class="st">`</span><span class="dt">array batch:ch1</span><span class="st">`</span>, pd<span class="op">$</span>geo_accession)),</a>
<a class="sourceLine" id="cb1-48" data-line-number="48"><span class="dt">bbs =</span> <span class="kw">as.factor</span>(<span class="kw">setNames</span>(pd<span class="op">$</span><span class="st">`</span><span class="dt">brain bank source:ch1</span><span class="st">`</span>, pd<span class="op">$</span>geo_accession)),</a>
<a class="sourceLine" id="cb1-49" data-line-number="49"><span class="dt">sex =</span> <span class="kw">as.factor</span>(<span class="kw">setNames</span>(pd<span class="op">$</span><span class="st">`</span><span class="dt">Sex:ch1</span><span class="st">`</span>, pd<span class="op">$</span>geo_accession)),</a>
<a class="sourceLine" id="cb1-50" data-line-number="50"><span class="dt">race =</span> <span class="kw">as.factor</span>(<span class="kw">setNames</span>(pd<span class="op">$</span><span class="st">`</span><span class="dt">race:ch1</span><span class="st">`</span>, pd<span class="op">$</span>geo_accession)))</a>
<a class="sourceLine" id="cb1-51" data-line-number="51">ages &lt;-<span class="st"> </span>ages[ages <span class="op">&gt;=</span><span class="st"> </span><span class="dv">20</span>]</a>
<a class="sourceLine" id="cb1-52" data-line-number="52">expmat &lt;-<span class="st"> </span>expmat[, <span class="kw">names</span>(ages)]</a>
<a class="sourceLine" id="cb1-53" data-line-number="53">covs &lt;-<span class="st"> </span><span class="kw">lapply</span>(covs, <span class="cf">function</span>(x)x[<span class="kw">names</span>(ages)])</a></code></pre></div>
</div>
<div id="calculating-the-age-related-changes-in-expression-level-and-heterogeneity" class="section level1">
<h1 class="hasAnchor">
<a href="#calculating-the-age-related-changes-in-expression-level-and-heterogeneity" class="anchor"></a>Calculating the age-related changes in expression level and heterogeneity</h1>
<p>We can simply use <code>calc.het</code> function in our package to have all relevant results:</p>
<ul>
<li>Here we supply ages in years (â€˜age_inâ€™ parameter) but we want the model to be constructed on the fourt root scale of age (â€˜age_toâ€™ parameter).</li>
<li>We want to apply first SVA and then Quantile Normalisation (â€˜batch_corrâ€™ parameter) to correct for the confounding factors.</li>
<li>The age-related change in gene expression will be modelled using a linear model (â€˜modexâ€™ parameter).</li>
<li>Data will not be log2 transformed (â€˜tr_log2â€™ parameter).</li>
<li>Features (probesets), will be scaled before the analysis (â€˜sc_featuresâ€™ parameter).</li>
<li>The list of covariates are provided to check the correlation between calculated SVs from unsupervised algorithm SVA.</li>
<li>We will use spearman correlation coefficient between absolute values of residuals from the model for age-related change in expression level and ages to assess age-related change in expression heterogeneity (â€˜het_change_metâ€™ parameter).</li>
<li>All p-values calculated within this function will be corrected for multiple testing using â€˜FDRâ€™ (â€˜padj_metâ€™ parameter).</li>
</ul>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1"><span class="kw">library</span>(hetAge)</a>
<a class="sourceLine" id="cb2-2" data-line-number="2">resx &lt;-<span class="st"> </span><span class="kw"><a href="../reference/calc.het.html">calc.het</a></span>(<span class="dt">exprmat =</span> expmat[<span class="kw">sample</span>(<span class="kw">rownames</span>(expmat),<span class="dv">1000</span>),], <span class="co"># expression matrix</span></a>
<a class="sourceLine" id="cb2-3" data-line-number="3">  <span class="dt">age =</span> ages, <span class="co"># age vector</span></a>
<a class="sourceLine" id="cb2-4" data-line-number="4">  <span class="dt">age_in =</span> <span class="st">'years'</span>,  <span class="co"># scale of the age vector</span></a>
<a class="sourceLine" id="cb2-5" data-line-number="5">  <span class="dt">age_to =</span> <span class="st">'pw-0.25'</span>, <span class="co"># scale of ages to be used</span></a>
<a class="sourceLine" id="cb2-6" data-line-number="6">  <span class="dt">batch_corr =</span> <span class="st">'SVA+QN'</span>,  <span class="co"># batch correction method</span></a>
<a class="sourceLine" id="cb2-7" data-line-number="7">  <span class="dt">modex =</span> <span class="st">'linear'</span>, <span class="co"># model for the change in expression level</span></a>
<a class="sourceLine" id="cb2-8" data-line-number="8">  <span class="dt">tr_log2 =</span> F, <span class="co"># log2 transform input matrix</span></a>
<a class="sourceLine" id="cb2-9" data-line-number="9">  <span class="dt">sc_features =</span> T, <span class="co"># scale genes / probesets</span></a>
<a class="sourceLine" id="cb2-10" data-line-number="10">  <span class="dt">covariates =</span> covs, <span class="co"># covariates</span></a>
<a class="sourceLine" id="cb2-11" data-line-number="11">  <span class="dt">het_change_met =</span> <span class="st">'spearman'</span>, <span class="co"># method to measure change in heterogeneity</span></a>
<a class="sourceLine" id="cb2-12" data-line-number="12">  <span class="dt">padj_met =</span> <span class="st">'fdr'</span>) <span class="co"># multiple test correction method</span></a>
<a class="sourceLine" id="cb2-13" data-line-number="13"><span class="co">#&gt; Number of significant surrogate variables is:  13 </span></a>
<a class="sourceLine" id="cb2-14" data-line-number="14"><span class="co">#&gt; Iteration (out of 5 ):1  2  3  4  5</span></a></code></pre></div>
</div>
<div id="result-object" class="section level1">
<h1 class="hasAnchor">
<a href="#result-object" class="anchor"></a>Result object</h1>
<p>The resulting object is a list with several fields.</p>
<div id="the-list-of-sampels-used-in-the-analysis" class="section level3">
<h3 class="hasAnchor">
<a href="#the-list-of-sampels-used-in-the-analysis" class="anchor"></a>The list of sampels used in the analysis:</h3>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1"><span class="kw">head</span>(resx<span class="op">$</span>sampleID)</a>
<a class="sourceLine" id="cb3-2" data-line-number="2"><span class="co">#&gt; [1] "GSM750020" "GSM750021" "GSM750022" "GSM750023" "GSM750024" "GSM750025"</span></a></code></pre></div>
</div>
<div id="the-expression-matrix-inputted-in-the-first-place-only-including-the-samples-used-in-the-analysis-" class="section level2">
<h2 class="hasAnchor">
<a href="#the-expression-matrix-inputted-in-the-first-place-only-including-the-samples-used-in-the-analysis-" class="anchor"></a>The expression matrix inputted in the first place, only including the samples used in the analysis.</h2>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1">resx<span class="op">$</span>input_expr[<span class="dv">1</span><span class="op">:</span><span class="dv">5</span>,<span class="dv">1</span><span class="op">:</span><span class="dv">5</span>]</a>
<a class="sourceLine" id="cb4-2" data-line-number="2"><span class="co">#&gt;                      GSM750020  GSM750021  GSM750022    GSM750023</span></a>
<a class="sourceLine" id="cb4-3" data-line-number="3"><span class="co">#&gt; HEEBO-009-HCC9J10  -0.49069362 -0.1552557 -0.2341012 -0.009444446</span></a>
<a class="sourceLine" id="cb4-4" data-line-number="4"><span class="co">#&gt; HEEBO-005-HCC5F20  -0.51718055 -0.3129041 -0.1865100  0.008877697</span></a>
<a class="sourceLine" id="cb4-5" data-line-number="5"><span class="co">#&gt; HEEBO-042-HCC42P8  -0.06706793 -0.3661042  0.2032148 -0.219423635</span></a>
<a class="sourceLine" id="cb4-6" data-line-number="6"><span class="co">#&gt; HEEBO-090-HCA90P3   0.23866957  0.2141466  0.2503593 -0.177477370</span></a>
<a class="sourceLine" id="cb4-7" data-line-number="7"><span class="co">#&gt; HEEBO-072-HCC72C11  0.37976870  0.2122618  0.3726183  0.513725636</span></a>
<a class="sourceLine" id="cb4-8" data-line-number="8"><span class="co">#&gt;                      GSM750024</span></a>
<a class="sourceLine" id="cb4-9" data-line-number="9"><span class="co">#&gt; HEEBO-009-HCC9J10  -0.04396614</span></a>
<a class="sourceLine" id="cb4-10" data-line-number="10"><span class="co">#&gt; HEEBO-005-HCC5F20   0.69603736</span></a>
<a class="sourceLine" id="cb4-11" data-line-number="11"><span class="co">#&gt; HEEBO-042-HCC42P8  -0.06549511</span></a>
<a class="sourceLine" id="cb4-12" data-line-number="12"><span class="co">#&gt; HEEBO-090-HCA90P3   0.24136461</span></a>
<a class="sourceLine" id="cb4-13" data-line-number="13"><span class="co">#&gt; HEEBO-072-HCC72C11 -0.05734488</span></a></code></pre></div>
</div>
<div id="the-ages-in-the-original-format-including-only-the-samples-used-in-the-analysis" class="section level2">
<h2 class="hasAnchor">
<a href="#the-ages-in-the-original-format-including-only-the-samples-used-in-the-analysis" class="anchor"></a>The ages in the original format, including only the samples used in the analysis</h2>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1"><span class="kw">head</span>(resx<span class="op">$</span>input_age)</a>
<a class="sourceLine" id="cb5-2" data-line-number="2"><span class="co">#&gt; GSM750020 GSM750021 GSM750022 GSM750023 GSM750024 GSM750025 </span></a>
<a class="sourceLine" id="cb5-3" data-line-number="3"><span class="co">#&gt;  20.22192  20.78630  20.86301  20.94521  21.01918  21.47397</span></a></code></pre></div>
</div>
<div id="the-ages-after-re-formetted-into-desired-format" class="section level2">
<h2 class="hasAnchor">
<a href="#the-ages-after-re-formetted-into-desired-format" class="anchor"></a>The ages after re-formetted into desired format</h2>
<p>Here we wanted the ages to be in fourth root scale.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1"><span class="kw">head</span>(resx<span class="op">$</span>usedAge)</a>
<a class="sourceLine" id="cb6-2" data-line-number="2"><span class="co">#&gt; GSM750020 GSM750021 GSM750022 GSM750023 GSM750024 GSM750025 </span></a>
<a class="sourceLine" id="cb6-3" data-line-number="3"><span class="co">#&gt;  9.268913  9.332920  9.341518  9.350705  9.358950  9.409170</span></a></code></pre></div>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" data-line-number="1"><span class="kw">library</span>(tidyverse)</a>
<a class="sourceLine" id="cb7-2" data-line-number="2"><span class="co">#&gt; â”€â”€ Attaching packages â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ tidyverse 1.2.1 â”€â”€</span></a>
<a class="sourceLine" id="cb7-3" data-line-number="3"><span class="co">#&gt; âœ” ggplot2 3.0.0.9000     âœ” purrr   0.2.5     </span></a>
<a class="sourceLine" id="cb7-4" data-line-number="4"><span class="co">#&gt; âœ” tibble  1.4.2          âœ” dplyr   0.7.5     </span></a>
<a class="sourceLine" id="cb7-5" data-line-number="5"><span class="co">#&gt; âœ” tidyr   0.8.1          âœ” stringr 1.3.1     </span></a>
<a class="sourceLine" id="cb7-6" data-line-number="6"><span class="co">#&gt; âœ” readr   1.1.1          âœ” forcats 0.3.0</span></a>
<a class="sourceLine" id="cb7-7" data-line-number="7"><span class="co">#&gt; â”€â”€ Conflicts â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ tidyverse_conflicts() â”€â”€</span></a>
<a class="sourceLine" id="cb7-8" data-line-number="8"><span class="co">#&gt; âœ– dplyr::combine()    masks Biobase::combine(), BiocGenerics::combine()</span></a>
<a class="sourceLine" id="cb7-9" data-line-number="9"><span class="co">#&gt; âœ– dplyr::exprs()      masks Biobase::exprs()</span></a>
<a class="sourceLine" id="cb7-10" data-line-number="10"><span class="co">#&gt; âœ– dplyr::filter()     masks stats::filter()</span></a>
<a class="sourceLine" id="cb7-11" data-line-number="11"><span class="co">#&gt; âœ– dplyr::lag()        masks stats::lag()</span></a>
<a class="sourceLine" id="cb7-12" data-line-number="12"><span class="co">#&gt; âœ– ggplot2::Position() masks BiocGenerics::Position(), base::Position()</span></a>
<a class="sourceLine" id="cb7-13" data-line-number="13"><span class="kw">data.frame</span>(<span class="dt">age =</span> resx<span class="op">$</span>input_age, <span class="dt">age0.25 =</span> resx<span class="op">$</span>usedAge) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb7-14" data-line-number="14"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> age, <span class="dt">y =</span> age0<span class="fl">.25</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb7-15" data-line-number="15"><span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb7-16" data-line-number="16"><span class="st">  </span><span class="kw">geom_smooth</span>( <span class="dt">method =</span> <span class="st">'loess'</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb7-17" data-line-number="17"><span class="st">  </span><span class="kw">theme_bw</span>()</a></code></pre></div>
<p><img src="tutorial-sva_files/figure-html/unnamed-chunk-7-1.png" width="700"></p>
</div>
<div id="expression-matrix-after-correcting-for-confounding-factors" class="section level2">
<h2 class="hasAnchor">
<a href="#expression-matrix-after-correcting-for-confounding-factors" class="anchor"></a>Expression matrix after correcting for confounding factors</h2>
<p>These are the expression values for the probesets after accounting for the predicting confounding factors, i.e.Â SVs</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" data-line-number="1">resx<span class="op">$</span>sva_res<span class="op">$</span>correctedExp[<span class="dv">1</span><span class="op">:</span><span class="dv">5</span>,<span class="dv">1</span><span class="op">:</span><span class="dv">5</span>]</a>
<a class="sourceLine" id="cb8-2" data-line-number="2"><span class="co">#&gt;                       GSM750020    GSM750021     GSM750022   GSM750023</span></a>
<a class="sourceLine" id="cb8-3" data-line-number="3"><span class="co">#&gt; HEEBO-009-HCC9J10   0.154861817 -0.081578816  0.1551155960  0.06967463</span></a>
<a class="sourceLine" id="cb8-4" data-line-number="4"><span class="co">#&gt; HEEBO-005-HCC5F20  -0.331445520 -0.134964858 -0.1410924992  0.13132288</span></a>
<a class="sourceLine" id="cb8-5" data-line-number="5"><span class="co">#&gt; HEEBO-042-HCC42P8  -0.001781817  0.002548202  0.1435209898 -0.07198311</span></a>
<a class="sourceLine" id="cb8-6" data-line-number="6"><span class="co">#&gt; HEEBO-090-HCA90P3  -0.120760310 -0.156358602 -0.0254051648 -0.09720619</span></a>
<a class="sourceLine" id="cb8-7" data-line-number="7"><span class="co">#&gt; HEEBO-072-HCC72C11 -0.076742822 -0.161336564 -0.0001683659  0.03165020</span></a>
<a class="sourceLine" id="cb8-8" data-line-number="8"><span class="co">#&gt;                      GSM750024</span></a>
<a class="sourceLine" id="cb8-9" data-line-number="9"><span class="co">#&gt; HEEBO-009-HCC9J10  -0.03247693</span></a>
<a class="sourceLine" id="cb8-10" data-line-number="10"><span class="co">#&gt; HEEBO-005-HCC5F20   0.26645341</span></a>
<a class="sourceLine" id="cb8-11" data-line-number="11"><span class="co">#&gt; HEEBO-042-HCC42P8   0.11641257</span></a>
<a class="sourceLine" id="cb8-12" data-line-number="12"><span class="co">#&gt; HEEBO-090-HCA90P3   0.13042938</span></a>
<a class="sourceLine" id="cb8-13" data-line-number="13"><span class="co">#&gt; HEEBO-072-HCC72C11 -0.26101170</span></a></code></pre></div>
</div>
<div id="svs-predicted-by-sva" class="section level2">
<h2 class="hasAnchor">
<a href="#svs-predicted-by-sva" class="anchor"></a>SVs predicted by SVA</h2>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" data-line-number="1"><span class="kw">head</span>(resx<span class="op">$</span>sva_res<span class="op">$</span>SVs)</a>
<a class="sourceLine" id="cb9-2" data-line-number="2"><span class="co">#&gt;                  SV_1         SV_2        SV_3         SV_4        SV_5</span></a>
<a class="sourceLine" id="cb9-3" data-line-number="3"><span class="co">#&gt; GSM750020  0.03400055  0.001139933 -0.01042920  0.042380353 -0.20374927</span></a>
<a class="sourceLine" id="cb9-4" data-line-number="4"><span class="co">#&gt; GSM750021  0.01786036 -0.118122439 -0.06446102 -0.063148824  0.10706829</span></a>
<a class="sourceLine" id="cb9-5" data-line-number="5"><span class="co">#&gt; GSM750022  0.04779599 -0.067292587  0.03389517  0.061073542 -0.01247557</span></a>
<a class="sourceLine" id="cb9-6" data-line-number="6"><span class="co">#&gt; GSM750023  0.04273805  0.033324693 -0.09133528  0.002186112  0.10177408</span></a>
<a class="sourceLine" id="cb9-7" data-line-number="7"><span class="co">#&gt; GSM750024 -0.08862562 -0.047667106 -0.01855060  0.044293165  0.14075867</span></a>
<a class="sourceLine" id="cb9-8" data-line-number="8"><span class="co">#&gt; GSM750025  0.04461789 -0.060383811 -0.06324593  0.005447534 -0.06549052</span></a>
<a class="sourceLine" id="cb9-9" data-line-number="9"><span class="co">#&gt;                   SV_6          SV_7         SV_8        SV_9       SV_10</span></a>
<a class="sourceLine" id="cb9-10" data-line-number="10"><span class="co">#&gt; GSM750020  0.001978613 -0.0591852306  0.039952822 -0.01604763  0.01416806</span></a>
<a class="sourceLine" id="cb9-11" data-line-number="11"><span class="co">#&gt; GSM750021 -0.077497730 -0.0401887419 -0.128050124  0.13270307 -0.04050873</span></a>
<a class="sourceLine" id="cb9-12" data-line-number="12"><span class="co">#&gt; GSM750022 -0.055398087 -0.0008724174  0.016473020  0.05649455 -0.15148269</span></a>
<a class="sourceLine" id="cb9-13" data-line-number="13"><span class="co">#&gt; GSM750023  0.047471357 -0.0115704842  0.117114663 -0.06513623  0.07177881</span></a>
<a class="sourceLine" id="cb9-14" data-line-number="14"><span class="co">#&gt; GSM750024  0.030980610  0.0698293211 -0.153280739  0.07579016  0.05148222</span></a>
<a class="sourceLine" id="cb9-15" data-line-number="15"><span class="co">#&gt; GSM750025 -0.070077193  0.0312486680  0.006699296 -0.01023673  0.08086847</span></a>
<a class="sourceLine" id="cb9-16" data-line-number="16"><span class="co">#&gt;                  SV_11        SV_12       SV_13</span></a>
<a class="sourceLine" id="cb9-17" data-line-number="17"><span class="co">#&gt; GSM750020 -0.008025665  0.074340649 -0.03631727</span></a>
<a class="sourceLine" id="cb9-18" data-line-number="18"><span class="co">#&gt; GSM750021  0.047865991  0.004230081 -0.11707898</span></a>
<a class="sourceLine" id="cb9-19" data-line-number="19"><span class="co">#&gt; GSM750022 -0.029495662 -0.019782473  0.01996362</span></a>
<a class="sourceLine" id="cb9-20" data-line-number="20"><span class="co">#&gt; GSM750023  0.036290944 -0.007566451  0.01730634</span></a>
<a class="sourceLine" id="cb9-21" data-line-number="21"><span class="co">#&gt; GSM750024  0.001954627 -0.088405800 -0.00562726</span></a>
<a class="sourceLine" id="cb9-22" data-line-number="22"><span class="co">#&gt; GSM750025 -0.071378195  0.077306215  0.02568342</span></a></code></pre></div>
</div>
<div id="correlation-between-known-potential-confounders-and-predicted-svs" class="section level2">
<h2 class="hasAnchor">
<a href="#correlation-between-known-potential-confounders-and-predicted-svs" class="anchor"></a>Correlation between known potential confounders and predicted SVs</h2>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" data-line-number="1"><span class="kw">head</span>(resx<span class="op">$</span>sva_res<span class="op">$</span>SV_cov_corr) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb10-2" data-line-number="2"><span class="st">  </span>knitr<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/knitr/topics/kable">kable</a></span>()</a></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">cov</th>
<th align="right">estimate</th>
<th align="right">p</th>
<th align="right">p.adj</th>
<th align="right">SV</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">array.1</td>
<td align="right">0.0032655</td>
<td align="right">0.9238819</td>
<td align="right">0.9776835</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">array.10</td>
<td align="right">-0.0160914</td>
<td align="right">0.6379988</td>
<td align="right">0.9776835</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">array.11</td>
<td align="right">-0.0732192</td>
<td align="right">0.0378125</td>
<td align="right">0.2772919</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">array.12</td>
<td align="right">-0.0228171</td>
<td align="right">0.5729957</td>
<td align="right">0.9776835</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">array.13</td>
<td align="right">-0.1464833</td>
<td align="right">0.0000460</td>
<td align="right">0.0005063</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">array.14</td>
<td align="right">-0.0616837</td>
<td align="right">0.1882470</td>
<td align="right">0.8282868</td>
<td align="right">1</td>
</tr>
</tbody>
</table>
</div>
<div id="the-expression-level-matrix-used-for-modeling" class="section level2">
<h2 class="hasAnchor">
<a href="#the-expression-level-matrix-used-for-modeling" class="anchor"></a>The expression level matrix used for modeling</h2>
<p>This is the matrix used to model age-related expression change - the reason it is different from corrected matrix is because we may further scale the expression level for the features (â€˜sc_featuresâ€™ parameter.)</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" data-line-number="1">resx<span class="op">$</span>usedMat[<span class="dv">1</span><span class="op">:</span><span class="dv">5</span>,<span class="dv">1</span><span class="op">:</span><span class="dv">5</span>]</a>
<a class="sourceLine" id="cb11-2" data-line-number="2"><span class="co">#&gt;                      GSM750020   GSM750021   GSM750022  GSM750023</span></a>
<a class="sourceLine" id="cb11-3" data-line-number="3"><span class="co">#&gt; HEEBO-009-HCC9J10   0.92838673 -0.46239493  1.01118021  0.4794767</span></a>
<a class="sourceLine" id="cb11-4" data-line-number="4"><span class="co">#&gt; HEEBO-005-HCC5F20  -1.78277057 -0.63905291 -0.93555134  0.7003564</span></a>
<a class="sourceLine" id="cb11-5" data-line-number="5"><span class="co">#&gt; HEEBO-042-HCC42P8  -0.09312124 -0.01907522  0.83788179 -0.3383901</span></a>
<a class="sourceLine" id="cb11-6" data-line-number="6"><span class="co">#&gt; HEEBO-090-HCA90P3  -0.66069240 -0.66349227 -0.13228584 -0.4083009</span></a>
<a class="sourceLine" id="cb11-7" data-line-number="7"><span class="co">#&gt; HEEBO-072-HCC72C11 -0.60087449 -0.92649846 -0.01984203  0.2962040</span></a>
<a class="sourceLine" id="cb11-8" data-line-number="8"><span class="co">#&gt;                     GSM750024</span></a>
<a class="sourceLine" id="cb11-9" data-line-number="9"><span class="co">#&gt; HEEBO-009-HCC9J10  -0.1391323</span></a>
<a class="sourceLine" id="cb11-10" data-line-number="10"><span class="co">#&gt; HEEBO-005-HCC5F20   1.1578777</span></a>
<a class="sourceLine" id="cb11-11" data-line-number="11"><span class="co">#&gt; HEEBO-042-HCC42P8   0.5448362</span></a>
<a class="sourceLine" id="cb11-12" data-line-number="12"><span class="co">#&gt; HEEBO-090-HCA90P3   0.5879536</span></a>
<a class="sourceLine" id="cb11-13" data-line-number="13"><span class="co">#&gt; HEEBO-072-HCC72C11 -1.3305385</span></a></code></pre></div>
</div>
<div id="residuals-from-the-model-between-expression-level-and-age" class="section level2">
<h2 class="hasAnchor">
<a href="#residuals-from-the-model-between-expression-level-and-age" class="anchor"></a>Residuals from the model between expression level and age</h2>
<p>Absolute values of this matrix can be considered as the level of heterogeneity for each gene, each sample.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" data-line-number="1">resx<span class="op">$</span>residMat[<span class="dv">1</span><span class="op">:</span><span class="dv">5</span>,<span class="dv">1</span><span class="op">:</span><span class="dv">5</span>]</a>
<a class="sourceLine" id="cb12-2" data-line-number="2"><span class="co">#&gt;                     GSM750020  GSM750021   GSM750022  GSM750023  GSM750024</span></a>
<a class="sourceLine" id="cb12-3" data-line-number="3"><span class="co">#&gt; HEEBO-009-HCC9J10   0.7642485 -0.6210528  0.85325861  0.3223417 -0.2955613</span></a>
<a class="sourceLine" id="cb12-4" data-line-number="4"><span class="co">#&gt; HEEBO-005-HCC5F20  -1.9001786 -0.7525408 -1.04851261  0.5879578  1.0459841</span></a>
<a class="sourceLine" id="cb12-5" data-line-number="5"><span class="co">#&gt; HEEBO-042-HCC42P8  -0.3945109 -0.3104018  0.54790715 -0.6269204  0.2576022</span></a>
<a class="sourceLine" id="cb12-6" data-line-number="6"><span class="co">#&gt; HEEBO-090-HCA90P3  -0.5795064 -0.5850170 -0.05417474 -0.3305789  0.6653265</span></a>
<a class="sourceLine" id="cb12-7" data-line-number="7"><span class="co">#&gt; HEEBO-072-HCC72C11 -0.3037955 -0.6393387  0.26598519  0.5806075 -1.0474128</span></a></code></pre></div>
</div>
<div id="data-frame-with-the-summaries-of-age-related-changes-in-expression-level-and-heterogeneity" class="section level2">
<h2 class="hasAnchor">
<a href="#data-frame-with-the-summaries-of-age-related-changes-in-expression-level-and-heterogeneity" class="anchor"></a>Data frame with the summaries of age-related changes in expression level and heterogeneity</h2>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" data-line-number="1"><span class="kw">colnames</span>(resx<span class="op">$</span>feature_result)</a>
<a class="sourceLine" id="cb13-2" data-line-number="2"><span class="co">#&gt; [1] "feature"                    "level_change"              </span></a>
<a class="sourceLine" id="cb13-3" data-line-number="3"><span class="co">#&gt; [3] "level_change.p"             "heterogeneity_change"      </span></a>
<a class="sourceLine" id="cb13-4" data-line-number="4"><span class="co">#&gt; [5] "heterogeneity_change.p"     "level_change.p.adj"        </span></a>
<a class="sourceLine" id="cb13-5" data-line-number="5"><span class="co">#&gt; [7] "heterogeneity_change.p.adj"</span></a>
<a class="sourceLine" id="cb13-6" data-line-number="6"><span class="kw">head</span>(resx<span class="op">$</span>feature_result) </a>
<a class="sourceLine" id="cb13-7" data-line-number="7"><span class="co">#&gt; # A tibble: 6 x 7</span></a>
<a class="sourceLine" id="cb13-8" data-line-number="8"><span class="co">#&gt;   feature   level_change level_change.p heterogeneity_châ€¦ heterogeneity_câ€¦</span></a>
<a class="sourceLine" id="cb13-9" data-line-number="9"><span class="co">#&gt;   &lt;chr&gt;            &lt;dbl&gt;          &lt;dbl&gt;             &lt;dbl&gt;            &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb13-10" data-line-number="10"><span class="co">#&gt; 1 HEEBO-00â€¦     -0.0856          0.324            -0.0498            0.547</span></a>
<a class="sourceLine" id="cb13-11" data-line-number="11"><span class="co">#&gt; 2 HEEBO-00â€¦     -0.0612          0.481             0.0839            0.310</span></a>
<a class="sourceLine" id="cb13-12" data-line-number="12"><span class="co">#&gt; 3 HEEBO-04â€¦     -0.157           0.0688            0.0548            0.508</span></a>
<a class="sourceLine" id="cb13-13" data-line-number="13"><span class="co">#&gt; 4 HEEBO-09â€¦      0.0424          0.626             0.0450            0.586</span></a>
<a class="sourceLine" id="cb13-14" data-line-number="14"><span class="co">#&gt; 5 HEEBO-07â€¦      0.155           0.0729            0.0158            0.849</span></a>
<a class="sourceLine" id="cb13-15" data-line-number="15"><span class="co">#&gt; 6 HEEBO-07â€¦      0.00829         0.924             0.0570            0.491</span></a>
<a class="sourceLine" id="cb13-16" data-line-number="16"><span class="co">#&gt; # ... with 2 more variables: level_change.p.adj &lt;dbl&gt;,</span></a>
<a class="sourceLine" id="cb13-17" data-line-number="17"><span class="co">#&gt; #   heterogeneity_change.p.adj &lt;dbl&gt;</span></a></code></pre></div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#download-data-and-prepare-for-the-analysis">Download data and prepare for the analysis</a></li>
      <li><a href="#calculating-the-age-related-changes-in-expression-level-and-heterogeneity">Calculating the age-related changes in expression level and heterogeneity</a></li>
      <li>
<a href="#result-object">Result object</a><ul class="nav nav-pills nav-stacked">
<li><a href="#the-expression-matrix-inputted-in-the-first-place-only-including-the-samples-used-in-the-analysis-">The expression matrix inputted in the first place, only including the samples used in the analysis.</a></li>
      <li><a href="#the-ages-in-the-original-format-including-only-the-samples-used-in-the-analysis">The ages in the original format, including only the samples used in the analysis</a></li>
      <li><a href="#the-ages-after-re-formetted-into-desired-format">The ages after re-formetted into desired format</a></li>
      <li><a href="#expression-matrix-after-correcting-for-confounding-factors">Expression matrix after correcting for confounding factors</a></li>
      <li><a href="#svs-predicted-by-sva">SVs predicted by SVA</a></li>
      <li><a href="#correlation-between-known-potential-confounders-and-predicted-svs">Correlation between known potential confounders and predicted SVs</a></li>
      <li><a href="#the-expression-level-matrix-used-for-modeling">The expression level matrix used for modeling</a></li>
      <li><a href="#residuals-from-the-model-between-expression-level-and-age">Residuals from the model between expression level and age</a></li>
      <li><a href="#data-frame-with-the-summaries-of-age-related-changes-in-expression-level-and-heterogeneity">Data frame with the summaries of age-related changes in expression level and heterogeneity</a></li>
      </ul>
</li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Melike Donertas, Ulas Isildak, Mehmet Somel, Janet Thornton.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://pkgdown.r-lib.org/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  

  </body>
</html>
